import { getEggImage } from '../constants/eggs'
import GaugeBar from './GaugeBar'
import './EggIncubator.css'

const HATCH_MAX = 24 // 부화 게이지 총 24칸

function EggIncubator({ centerEgg, affection, gaugeProgress, remainingMs }) {
    // centerEgg: 부화 중인 알 (null 또는 egg 객체)
    // affection: 현재 부화 게이지 값 (0~24)
    // gaugeProgress: 현재 1시간 구간 내 진행률 (0~1)
    // remainingMs: 부화까지 남은 시간 (ms)

    // 남은 ms → "HH:MM" (예: 23:59, 01:10)
    const formatRemainingTime = (ms) => {
        const totalSec = Math.max(0, Math.floor(ms / 1000))
        const h = Math.floor(totalSec / 3600)
        const m = Math.floor((totalSec % 3600) / 60)
        return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`
    }

    return (
        <div className="incubator-container">
            <div className="incubator-display">
                {centerEgg && centerEgg.eggType ? (
                    <div className="incubator-egg-wrapper">
                        <img
                            src={getEggImage(centerEgg.eggType)}
                            alt="부화 중인 알"
                            className="incubator-egg-img"
                            draggable={false}
                        />
                        {/* 알 바로 아래 게이지 */}
                        <div className="incubator-gauge-wrapper">
                            <div className="incubator-gauge">
                                <GaugeBar
                                    label=""
                                    value={Math.min(HATCH_MAX, affection + gaugeProgress)}
                                    maxValue={HATCH_MAX}
                                    color="affection"
                                />
                            </div>
                            {/* 게이지 바로 아래 남은 시간 */}
                            <div className="incubator-time">
                                {affection >= HATCH_MAX ? '00:00' : formatRemainingTime(remainingMs)}
                            </div>
                        </div>
                    </div>
                ) : (
                    <div className="incubator-empty" />
                )}
            </div>
        </div>
    )
}

export default EggIncubator
